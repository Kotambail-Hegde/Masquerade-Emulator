<!DOCTYPE html>
<html>
<head>
<style>
table { border-collapse: collapse }
.emulator { position: sticky; top: 0px; }
.test { position: sticky; left: 0px; }
.tooltiptext { visibility: hidden; width: 200px; background-color: black; color: #fff; text-align: center; padding: 5px 0; border-radius: 6px; position: absolute; z-index: 1; left: 102%; }
tr:hover .tooltiptext { visibility: visible; }
td, th { border: #333 solid 1px; text-align: center; line-height: 1.5}
.PASS { background-color: #6e2 }
.FAIL { background-color: #e44 }
.INFO { background-color: #ddd }
td {font-size:80%}
th{background:#eee}
th:first-child{text-align:right; padding-right:4px}
.screenshot { width: 160; height: 144; }
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif}
</style>
</head>
<body>
<table id="resultsTable"></table>

<script>
window.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('masquerade.json');
        if (response.ok) {
            const json = await response.json();
            displayResults(json);
        }
    } catch (e) {
        console.log('masquerade.json not found');
    }
});

function displayResults(data) {
    const tests = data.tests;
    const testCount = Object.keys(tests).length;
    const passCount = Object.values(tests).filter(t => t.result === 'PASS').length;
    
    let emulatorName = data.emulator || 'Emulator';
    let dateStr = '';
    if (data.date) {
        const date = new Date(data.date * 1000);
        dateStr = date.toUTCString();
    }
    
    let html = '<tr><th style="text-align:left">Updated On<br>' + dateStr + '</th>';
	html += `
	<th class="emulator">
		<a href="https://github.com/Kotambail-Hegde/Masquerade-Emulator"
		   target="_blank"
		   style="text-decoration:none;">
		   ${emulatorName}
		</a> (${passCount}/${testCount})
	</th></tr>`;

    
    for (const [testName, testInfo] of Object.entries(tests)) {
        const result = testInfo.result || 'No result';
        
        html += "<tr><th class='test'>" + escapeHtml(testName) + "</th>";
        html += "<td class='" + result + "'>" + result;
        
        if (testInfo.screenshot) {
            html += "<br><img class='screenshot' src='data:image/png;base64," + testInfo.screenshot + "'>";
        }
        
        html += "</td></tr>";
    }
    
    document.getElementById('resultsTable').innerHTML = html;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
</body>
</html>